{"version":3,"file":"4264.0a699b0a458ba3f6.js","mappings":"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","names":["DescontocombustiveisService","_DescontocombustiveisService","constructor","dbService","this","addDescontoCombustivel","iddesconto","idcombustivel","idbomba","idbico","nome","preco","totallitros","totalprecocombustivel","totaldescontocombustivel","totaldescontorecebidocombustivel","_this","_asyncToGenerator","updateDescontoCombustivel","id","_this2","getDescontosCombustiveisByDescontoId","_this3","descontoscombustiveis","where","equals","toArray","deleteDescontosCombustiveis","_this4","i0","i1","factory","ɵfac","providedIn","DescontotipopagamentoService","_DescontotipopagamentoService","addDescontotipopagamentoService","tipopagamento","valorpago","addDescontoTiposPagamento","updateDescontotipopagamentoService","updateDescontoTiposPagamento","getDescontoTiposPagamentoByDescontoId","deleteDescontoTiposPagamento","desconto_r2","totaldesconto","ctx_r2","formatDateTime","datahora","nomeatendente","_c0","item_r4","DescontoPage_ion_accordion_8_span_3_Template","DescontoPage_ion_accordion_8_span_4_Template","_r1","$implicit","viewDesconto","cancelaDesconto","DescontoPage_ion_accordion_8_ion_item_11_Template","cancelado","descontosCombustiveis","routes","path","component","_DescontoPage","DescontoPage","descontoService","descontocombustiveisService","descontotipopagamentoService","alertController","descontoDataService","router","utilService","gerarDadosRetornoIntegracaoService","pedidoService","descontos","descontoTiposPagamento","ngOnInit","ionViewWillEnter","loadDescontos","getAllDescontos","sort","a","b","Date","getTime","desconto","error","console","showAlert","DescontoSelecionado","getDescontoById","_ref","_ref2","confirmado","create","header","message","buttons","text","role","handler","cancelaDescontoAPI","gerarDadosRetornoIntegracao","apply","arguments","present","deleteDesconto","corpo","pedidoId","idpedidodidiglobal","Recibo","numerorecibo","toString","cupom","cancelarPedido","log","JSON","stringify","trace_Id","statusCode","errmsg","errorMsg","HttpErrorResponse","setDesconto","clearCurrentDescontoCombustivel","clearCurrentDescontoTiposPagamento","setDescontosCombustiveis","setDescontoTiposPagamento","navigate","redirectGerarDesconto","clear","dataHora","date","String","getDate","padStart","getMonth","getFullYear","getHours","getMinutes","getSeconds","_this5","itensCorpo","itensApi","SomaTotalDescontoRecebido","Desconto","DescontosCombustiveis","DescontoTiposPagamento","itensDescontosCombustiveis","itemCorpo","idDesconto","idCombustivel","idBomba","idBico","totalLitros","totalPrecoCombustivel","totalDescontoCombustivel","totalDescontoRecebidoCombustivel","push","itensDescontoTiposPagamento","tipo","valor","descontoPagamento","NomeAtendente","totalPreco","totalpreco","totalDesconto","recibo","idPedidoDidiGlobal","codigoDesconto","codigodesconto","totalDescontoRecebido","descontoCombustivel","retornoGerouArquivo","gerarDadosRetorno","arquivoGerado","i2","i3","i4","i5","i6","i7","i8","i9","selectors","decls","vars","consts","template","rf","ctx","DescontoPage_ion_accordion_8_Template","DescontoPageRoutingModule","_DescontoPageRoutingModule","RouterModule","forChild","DescontoPageModule","_DescontoPageModule","CommonModule","FormsModule","IonicModule"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./src/app/services/descontocombustiveis/descontocombustiveis.service.ts","./src/app/services/descontotipopagamento/descontotipopagamento.service.ts","./src/app/pages/cadastro/desconto/desconto.page.html","./src/app/pages/cadastro/desconto/desconto-routing.module.ts","./src/app/pages/cadastro/desconto/desconto.page.ts","./src/app/pages/cadastro/desconto/desconto.module.ts"],"sourcesContent":["// src\\app\\services\\descontocombustiveis\\descontocombustiveis.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { DatabaseService, DescontosCombustiveis } from '../database.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DescontocombustiveisService {\r\n  constructor(private dbService: DatabaseService) {}\r\n\r\n  async addDescontoCombustivel(\r\n    iddesconto: number,\r\n    idcombustivel: number,\r\n    idbomba: number,\r\n    idbico: number,\r\n    nome: string,\r\n    preco: number,\r\n    totallitros: number,\r\n    totalprecocombustivel: number,\r\n    totaldescontocombustivel: number,\r\n    totaldescontorecebidocombustivel: number\r\n  ) {\r\n    return await this.dbService.addDescontoCombustivel(\r\n      iddesconto,\r\n      idcombustivel,\r\n      idbomba,\r\n      idbico,\r\n      nome,\r\n      preco,\r\n      totallitros,\r\n      totalprecocombustivel,\r\n      totaldescontocombustivel,\r\n      totaldescontorecebidocombustivel\r\n    );\r\n  }\r\n\r\n  async updateDescontoCombustivel(\r\n    id: number,\r\n    iddesconto: number,\r\n    idcombustivel: number,\r\n    idbomba: number,\r\n    idbico: number,\r\n    nome: string,\r\n    preco: number,\r\n    totallitros: number,\r\n    totalprecocombustivel: number,\r\n    totaldescontocombustivel: number,\r\n    totaldescontorecebidocombustivel: number\r\n  ) {\r\n    return await this.dbService.updateDescontoCombustivel(\r\n      id,\r\n      iddesconto,\r\n      idcombustivel,\r\n      idbomba,\r\n      idbico,\r\n      nome,\r\n      preco,\r\n      totallitros,\r\n      totalprecocombustivel,\r\n      totaldescontocombustivel,\r\n      totaldescontorecebidocombustivel\r\n    );\r\n  }\r\n\r\n  /*   async getDescontoCombustiveisByDescontoId(iddesconto: number) {\r\n    return await this.dbService.getDescontoCombustiveisByDescontoId(iddesconto);\r\n  } */\r\n\r\n  async getDescontosCombustiveisByDescontoId(id: number): Promise<DescontosCombustiveis[]> {\r\n    return await this.dbService.descontoscombustiveis.where('iddesconto').equals(id).toArray();\r\n  }\r\n\r\n  async deleteDescontosCombustiveis(id: number){\r\n    return await this.dbService.deleteDescontosCombustiveis(id);\r\n  }\r\n}\r\n","// src\\app\\services\\descontotipopagamento\\descontotipopagamento.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { DatabaseService, DescontoTiposPagamento } from '../database.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DescontotipopagamentoService {\r\n  constructor(private dbService: DatabaseService) {}\r\n\r\n  async addDescontotipopagamentoService(\r\n    iddesconto: number,\r\n    tipopagamento: string,\r\n    valorpago: number\r\n    ){\r\n      return await this.dbService.addDescontoTiposPagamento(\r\n        iddesconto, \r\n        tipopagamento, \r\n        valorpago)\r\n    };\r\n  \r\n  async updateDescontotipopagamentoService(\r\n    id: number,\r\n    iddesconto: number,\r\n    tipopagamento: string,\r\n    valorpago: number\r\n    ){\r\n      return await this.dbService.updateDescontoTiposPagamento(\r\n        id,\r\n        iddesconto, \r\n        tipopagamento, \r\n        valorpago)\r\n    };\r\n\r\n  async getDescontoTiposPagamentoByDescontoId(id: number): Promise<DescontoTiposPagamento[]>{\r\n    return await this.dbService.getDescontoTiposPagamentoByDescontoId(id);\r\n  }\r\n\r\n  async deleteDescontoTiposPagamento(id: number){\r\n    return await this.dbService.deleteDescontoTiposPagamento(id);\r\n  }\r\n}\r\n","<!-- src/app/pages/cadastro/desconto/desconto.page.html -->\r\n\r\n<ion-header [translucent]=\"true\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Lista de Descontos</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content>\r\n  <ion-accordion-group>\r\n    <ion-accordion *ngFor=\"let desconto of descontos\">\r\n      <ion-item slot=\"header\">\r\n        <ion-label>\r\n          <span *ngIf=\"!desconto?.cancelado\">\r\n            Desconto: {{ desconto.id }} - R${{ desconto.totaldesconto | number: '1.2-2' }} - {{ formatDateTime(desconto.datahora) }} - Atendente: {{ desconto.nomeatendente }}\r\n          </span>\r\n          <span *ngIf=\"desconto?.cancelado\" [ngStyle]=\"{'color': 'red'}\">\r\n            Desconto Cancelado: {{ desconto.id }} - R${{ desconto.totaldesconto | number: '1.2-2' }} - {{ formatDateTime(desconto.datahora) }} - Atendente: {{ desconto.nomeatendente }}\r\n          </span>\r\n        </ion-label>\r\n        <ion-buttons slot=\"end\">\r\n          <ion-button (click)=\"viewDesconto(desconto)\">Visualizar</ion-button>\r\n          <ion-button color=\"danger\" (click)=\"cancelaDesconto(desconto.id)\">Cancelar</ion-button>\r\n        </ion-buttons>\r\n      </ion-item>\r\n      <ion-list slot=\"content\">\r\n        <ion-item *ngFor=\"let item of descontosCombustiveis[desconto.id]\">\r\n          <ion-label>\r\n            <!-- <h2>Código: {{ item.id }}</h2> -->\r\n            <p>Bomba: {{ item.idbomba }}</p>\r\n            <p>Bico: {{ item.idbico }}</p>\r\n            <p>Combustível: {{ item.nome }}</p>\r\n            <p>Preço: {{ item.preco }}</p>\r\n            <p>Total de litros abastecidos: {{ item.totallitros | number: '1.2-2'}}</p>\r\n            <p>Total sem desconto: R${{ item.totalprecocombustivel | number: '1.2-2'}}</p>\r\n            <p>Total de desconto recebido: R${{ item.totaldescontorecebidocombustivel | number: '1.2-2'}}</p>            \r\n            <p color=\"danger\">Total com desconto: R${{ item.totaldescontocombustivel | number: '1.2-2'}}</p>\r\n          </ion-label>\r\n        </ion-item>\r\n      </ion-list>\r\n    </ion-accordion>\r\n  </ion-accordion-group>\r\n\r\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\r\n    <ion-fab-button (click)=\"redirectGerarDesconto()\">\r\n      <ion-icon name=\"add\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n</ion-content>\r\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { DescontoPage } from './desconto.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: DescontoPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class DescontoPageRoutingModule {}\n","// src/app/pages/cadastro/desconto/desconto.page.ts\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { AlertController } from '@ionic/angular';\r\nimport { DescontoService } from '../../../services/desconto/desconto.service';\r\nimport { DescontocombustiveisService } from '../../../services/descontocombustiveis/descontocombustiveis.service';\r\nimport { DescontotipopagamentoService } from 'src/app/services/descontotipopagamento/descontotipopagamento.service';\r\nimport { Desconto, DescontoTiposPagamento, DescontosCombustiveis } from '../../../services/database.service';\r\nimport { DescontoDataService } from '../../../services/desconto-data/desconto-data.service';\r\nimport { Router } from '@angular/router';\r\nimport { UtilService } from '../../../services/util/util.service';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { PedidoService } from 'src/app/core/services/pedido.service';\r\nimport {GerarDadosRetornoIntegracaoRequest, GerarDadosRetornoIntegracaoDescontoCombustivelRequest, GerarDadosRetornoIntegracaoPagamentoPedidoRequest} from '../../../shared/models/gerarDadosRetornoIntegracaoRequest';\r\nimport { GerarDadosRetornoIntegracaoService } from 'src/app/core/services/gerar-dados-retorno-integracao.service';\r\nimport { cancelarPedidoRequest } from 'src/app/shared/models/cancelarPedido.request.model';\r\n\r\n@Component({\r\n  selector: 'app-desconto',\r\n  templateUrl: './desconto.page.html',\r\n  styleUrls: ['./desconto.page.scss']\r\n})\r\nexport class DescontoPage implements OnInit {\r\n  descontos: Desconto[] = [];\r\n  descontosCombustiveis: { [key: number]: DescontosCombustiveis[] } = {};\r\n  descontoTiposPagamento: { [key: number]: DescontoTiposPagamento[] } = {};\r\n\r\n  SomaTotalDescontoRecebido: number;\r\n\r\n  constructor(\r\n    private descontoService: DescontoService,\r\n    private descontocombustiveisService: DescontocombustiveisService,\r\n    private descontotipopagamentoService: DescontotipopagamentoService,\r\n    private alertController: AlertController,\r\n    private descontoDataService: DescontoDataService,\r\n    private router: Router,\r\n    private utilService: UtilService,\r\n    private gerarDadosRetornoIntegracaoService: GerarDadosRetornoIntegracaoService,\r\n    private pedidoService: PedidoService,\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    // Deixar comentado. Só chamar o loadDescontos no ionViewWillEnter. Pois gera conflito chamar nos dois locais.\r\n    // É ideal chamar no ionViewWillEnter pois é chamado quando atualiza a página e não apenas quando entra.\r\n\r\n    //this.loadDescontos();\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    // Este método é chamado sempre que a página está prestes a ser exibida\r\n    // Garante que os combustíveis sejam carregados sempre que o usuário voltar para esta página\r\n\r\n    this.loadDescontos();\r\n  }\r\n\r\n  async loadDescontos() {\r\n    try {\r\n      // Limpar dados anteriores\r\n      this.descontos = [];\r\n      this.descontosCombustiveis = {};\r\n      // Carregar os descontos\r\n      this.descontos = await this.descontoService.getAllDescontos();\r\n      this.descontos.sort((a, b) => new Date(b.datahora).getTime() - new Date(a.datahora).getTime());\r\n      // Carregar os registros filhos associados\r\n      for (let desconto of this.descontos) {\r\n        this.descontosCombustiveis[desconto.id] = await this.descontocombustiveisService.getDescontosCombustiveisByDescontoId(desconto.id);\r\n        this.descontoTiposPagamento[desconto.id] = await this.descontotipopagamentoService.getDescontoTiposPagamentoByDescontoId(desconto.id);\r\n      } \r\n    } catch (error) {\r\n      console.error('Erro ao carregar descontos', error);\r\n      await this.utilService.showAlert('Erro', 'Não foi possível carregar os descontos.');\r\n    }      \r\n  }\r\n\r\n  async cancelaDesconto(iddesconto: number) {\r\n    const DescontoSelecionado = await this.descontoService.getDescontoById(iddesconto);\r\n    if(DescontoSelecionado && DescontoSelecionado?.cancelado){\r\n      await this.utilService.showAlert('Erro', `O Desconto já está cancelado.`);\r\n      return;\r\n    } else if (DescontoSelecionado && !DescontoSelecionado?.confirmado){\r\n      const alert = await this.alertController.create({\r\n        header: 'Confirmar a exclusão',\r\n        message: 'O Desconto ainda não foi gerado para ser cancelado. Deseja excluir este desconto?',\r\n        buttons: [\r\n          {\r\n            text: 'Não',\r\n            role: 'cancel'\r\n          },\r\n          {\r\n            text: 'Sim',\r\n            handler: async () => {            \r\n              await this.descontoService.deleteDesconto(iddesconto);\r\n              this.loadDescontos();\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      await alert.present();\r\n\r\n      return;\r\n    }\r\n\r\n    const alert = await this.alertController.create({\r\n      header: 'Confirmar o cancelamento',\r\n      message: 'Deseja realmente cancelar este desconto?',\r\n      buttons: [\r\n        {\r\n          text: 'Não',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Sim',\r\n          handler: async () => {        \r\n            await this.cancelaDescontoAPI(iddesconto);    \r\n            await this.descontoService.cancelaDesconto(iddesconto);\r\n            await this.gerarDadosRetornoIntegracao(iddesconto);\r\n            this.loadDescontos();\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  // Cancela Desconto na DidiGlobal\r\n  async cancelaDescontoAPI(iddesconto: number){\r\n    const DescontoSelecionado = await this.descontoService.getDescontoById(iddesconto);\r\n\r\n    const corpo: cancelarPedidoRequest = {\r\n      pedidoId: DescontoSelecionado.idpedidodidiglobal,\r\n      Recibo: DescontoSelecionado.numerorecibo.toString()\r\n    };\r\n\r\n    try {\r\n      const cupom = await this.pedidoService.cancelarPedido(corpo);\r\n\r\n      console.log(`${JSON.stringify(corpo)}`);\r\n      console.log(`TraceID CancelaDesconto: ${cupom.trace_Id}`);\r\n      console.log(`statusCode: ${cupom.statusCode}`);\r\n\r\n      if (cupom.statusCode = 200){\r\n        DescontoSelecionado.cancelado = true;\r\n        return true;\r\n      }else{\r\n        await this.utilService.showAlert('Erro', `Não foi possível cancelar o desconto: ${cupom.errmsg}`);\r\n        return false;\r\n      }      \r\n    } catch (error) {\r\n      console.error('Erro ao cancelar desconto:', error);\r\n\r\n      // Extraia a mensagem de erro correta do objeto error\r\n      let errorMsg = 'Erro desconhecido';\r\n      if (error instanceof HttpErrorResponse) {\r\n        if (error.error && typeof error.error === 'object' && 'errmsg' in error.error) {\r\n          errorMsg = error.error.errmsg;\r\n        } else if (error.message) {\r\n          errorMsg = error.message;\r\n        }\r\n      }\r\n      \r\n      await this.utilService.showAlert('Erro', `Não foi possível cancelar o desconto: ${errorMsg}`);\r\n      return false;\r\n    }\r\n  }  \r\n\r\n  async viewDesconto(desconto: Desconto) {\r\n    this.descontoDataService.setDesconto(desconto);\r\n    this.descontoDataService.clearCurrentDescontoCombustivel();\r\n    this.descontoDataService.clearCurrentDescontoTiposPagamento();\r\n\r\n    const descontosCombustiveis = await this.descontocombustiveisService.getDescontosCombustiveisByDescontoId(desconto.id!);\r\n    this.descontoDataService.setDescontosCombustiveis(descontosCombustiveis);\r\n    \r\n    const descontoTiposPagamento = await this.descontotipopagamentoService.getDescontoTiposPagamentoByDescontoId(desconto.id!);\r\n    this.descontoDataService.setDescontoTiposPagamento(descontoTiposPagamento);\r\n\r\n    this.router.navigate(['/caddesconto']);\r\n  }\r\n\r\n  redirectGerarDesconto() {\r\n    this.descontoDataService.clear();\r\n    this.router.navigate(['/caddesconto']);\r\n  }\r\n\r\n  formatDateTime(dataHora: Date): string {\r\n    if (!dataHora) {\r\n      return '';\r\n    }\r\n    const date = new Date(dataHora);\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based\r\n    const year = date.getFullYear();\r\n    const hours = String(date.getHours()).padStart(2, '0');\r\n    const minutes = String(date.getMinutes()).padStart(2, '0');\r\n    const seconds = String(date.getSeconds()).padStart(2, '0');\r\n    return `${day}/${month}/${year} - ${hours}:${minutes}:${seconds}`;\r\n  }\r\n\r\n  async gerarDadosRetornoIntegracao(iddesconto: number){\r\n    const itensCorpo: GerarDadosRetornoIntegracaoDescontoCombustivelRequest[] = [];\r\n    const itensApi: GerarDadosRetornoIntegracaoPagamentoPedidoRequest[] = [];\r\n\r\n    this.SomaTotalDescontoRecebido = 0;\r\n\r\n    const Desconto = await this.descontoService.getDescontoById(iddesconto);\r\n    const DescontosCombustiveis = await this.descontocombustiveisService.getDescontosCombustiveisByDescontoId(iddesconto);\r\n    const DescontoTiposPagamento = await this.descontotipopagamentoService.getDescontoTiposPagamentoByDescontoId(iddesconto);\r\n\r\n    for (const itensDescontosCombustiveis of DescontosCombustiveis){\r\n\r\n      const itemCorpo: GerarDadosRetornoIntegracaoDescontoCombustivelRequest = {\r\n        id : itensDescontosCombustiveis.id,\r\n        idDesconto: itensDescontosCombustiveis.iddesconto,\r\n        idCombustivel: itensDescontosCombustiveis.idcombustivel,\r\n        idBomba: itensDescontosCombustiveis.idbomba,\r\n        idBico: itensDescontosCombustiveis.idbico,\r\n        nome: itensDescontosCombustiveis.nome,\r\n        preco: itensDescontosCombustiveis.preco,\r\n        totalLitros: itensDescontosCombustiveis.totallitros,\r\n        totalPrecoCombustivel: itensDescontosCombustiveis.totalprecocombustivel,\r\n        totalDescontoCombustivel: itensDescontosCombustiveis.totaldescontocombustivel,\r\n        totalDescontoRecebidoCombustivel: itensDescontosCombustiveis.totaldescontorecebidocombustivel,\r\n      };\r\n\r\n      this.SomaTotalDescontoRecebido += itensDescontosCombustiveis.totaldescontorecebidocombustivel;\r\n\r\n      itensCorpo.push(itemCorpo);\r\n    }\r\n\r\n    for (const itensDescontoTiposPagamento of DescontoTiposPagamento){\r\n\r\n      const itemApi : GerarDadosRetornoIntegracaoPagamentoPedidoRequest = {\r\n        id: itensDescontoTiposPagamento.id,\r\n        idDesconto: itensDescontoTiposPagamento.iddesconto,\r\n        tipo: itensDescontoTiposPagamento.tipopagamento,\r\n        valor: itensDescontoTiposPagamento.valorpago,\r\n      };\r\n\r\n      itensApi.push(itemApi);\r\n    }\r\n\r\n    const corpo: GerarDadosRetornoIntegracaoRequest = {\r\n      id: Desconto.id,\r\n      descontoPagamento: itensApi,\r\n      NomeAtendente: Desconto.nomeatendente,\r\n      totalPreco: Desconto.totalpreco,\r\n      totalDesconto : Desconto.totaldesconto,\r\n      dataHora: Desconto.datahora,\r\n      recibo: Desconto.numerorecibo,\r\n      idPedidoDidiGlobal: Desconto.idpedidodidiglobal,\r\n      codigoDesconto: Desconto.codigodesconto,\r\n      confirmado: Desconto.confirmado,\r\n      totalDescontoRecebido: this.SomaTotalDescontoRecebido,\r\n      cancelado: Desconto.cancelado,\r\n      descontoCombustivel: itensCorpo,\r\n    }\r\n\r\n    try {\r\n      const retornoGerouArquivo = await this.gerarDadosRetornoIntegracaoService.gerarDadosRetorno(corpo);\r\n\r\n      console.log(`${JSON.stringify(corpo)}`);\r\n\r\n      if(!retornoGerouArquivo.arquivoGerado){\r\n        await this.utilService.showAlert('Erro', `Não foi possível gerar o arquivo de retorno JSON`);\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Erro ao gerar retorno:', error);\r\n\r\n      // Extraia a mensagem de erro correta do objeto error\r\n      let errorMsg = 'Erro desconhecido';\r\n      if (error instanceof HttpErrorResponse) {\r\n        if (error.error && typeof error.error === 'object' && 'errmsg' in error.error) {\r\n          errorMsg = error.error.errmsg;\r\n        } else if (error.message) {\r\n          errorMsg = error.message;\r\n        }\r\n      }\r\n      \r\n      await this.utilService.showAlert('Erro', `Não foi possível gerar o arquivo de retorno JSON: ${errorMsg}`);\r\n      return false;\r\n    }    \r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { DescontoPageRoutingModule } from './desconto-routing.module';\n\nimport { DescontoPage } from './desconto.page';\n\n@NgModule({\n  imports: [CommonModule, FormsModule, IonicModule, DescontoPageRoutingModule],\n  declarations: [DescontoPage]\n})\nexport class DescontoPageModule {}\n"],"x_google_ignoreList":[]}