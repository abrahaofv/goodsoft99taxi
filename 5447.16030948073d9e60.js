"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5447],{5447:(M,v,s)=>{s.r(v),s.d(v,{CadbombaPageModule:()=>S});var p=s(316),g=s(496),n=s(957),m=s(1379),c=s(9204),e=s(7404),f=s(3857),h=s(9139),C=s(4747);const w=[{path:"",component:(()=>{var t;class d{constructor(o,i,b,a,r,u){this.bombaService=o,this.route=i,this.bombaDataService=b,this.alertController=a,this.router=r,this.utilService=u,this.newBomba={idbomba:null,idbicos:""}}ngOnInit(){this.loadBomba()}loadBomba(){const o=this.bombaDataService.getBomba();o&&(this.newBomba=o)}saveBomba(){var o=this;return(0,c.A)(function*(){if(!(yield o.validacoesSaveBomba()))return;let i="";if(null==(yield o.bombaService.getBombaById(o.newBomba.idbomba))){const r=yield o.bombaService.addBomba(o.newBomba.idbomba,o.newBomba.idbicos);o.newBomba.idbomba=r,i=`Bomba ${r} adicionada com sucesso!`}else yield o.bombaService.updateBomba(o.newBomba.idbomba,o.newBomba.idbicos),i=`Bomba ${o.newBomba.idbomba} atualizada com sucesso!`;yield(yield o.alertController.create({header:"Sucesso",message:i,buttons:[{text:"OK",handler:()=>{o.router.navigate(["/bomba"])}}]})).present()})()}showAlert(o,i){var b=this;return(0,c.A)(function*(){yield(yield b.alertController.create({header:o,message:i,buttons:["OK"]})).present()})()}voltarPagina(){this.router.navigate(["/bomba"])}validaBicoJaCadastrado(){var o=this;return(0,c.A)(function*(){const i=yield o.bombaService.getAllBombas(),b=o.newBomba.idbicos.split(",").map(Number);for(const a of b)for(const r of i)if(r.idbicos.split(",").map(Number).includes(a)&&r.idbomba!==o.newBomba.idbomba)return yield o.utilService.showAlert("Erro de Valida\xe7\xe3o",`O bico ${a} j\xe1 est\xe1 cadastrado na bomba ${r.idbomba}.`),!1;return!0})()}temBicosDuplicados(o){const i=o.split(",").map(a=>a.trim()),b=new Set(i);return i.length!==b.size}validacoesSaveBomba(){var o=this;return(0,c.A)(function*(){if(!o.newBomba.idbomba||!o.newBomba.idbicos)return yield o.utilService.showAlert("Erro","Todos os campos s\xe3o obrigat\xf3rios."),!1;if(!/^\d+$/.test(o.newBomba.idbomba.toString()))return yield o.utilService.showAlert("Erro","O campo Bomba deve conter apenas n\xfameros."),!1;if(o.newBomba.idbicos=o.newBomba.idbicos.replace(/(^,)|(,$)/g,""),!/^(\d+)(,\d+)*$/.test(o.newBomba.idbicos))return yield o.utilService.showAlert("Erro","O campo Bicos deve conter apenas n\xfameros e v\xedrgulas."),!1;const a=o.bombaDataService.getBomba(),{isValid:r,mensagem:u}=yield o.bombaService.validateBicos(o.newBomba.idbicos);if(!(r||null!=a&&a.idbicos||null!=a&&a.idbomba||null==(null==a?void 0:a.idbomba)||(null==a?void 0:a.idbomba)==o.newBomba.idbomba))return yield o.utilService.showAlert("Erro",u),!1;const B=yield o.bombaService.getBombaById(o.newBomba.idbomba);return B&&(null==a?void 0:a.idbomba)>0?(yield o.utilService.showAlert("Erro",`A Bomba ${B.idbomba} j\xe1 foi cadastrada.`),!1):!(!(yield o.validaBicoJaCadastrado())||o.temBicosDuplicados(o.newBomba.idbicos)&&(yield o.utilService.showAlert("Erro","H\xe1 bicos duplicados no campo Bicos. Verifique."),1))})()}}return(t=d).\u0275fac=function(o){return new(o||t)(e.rXU(f.J),e.rXU(m.nX),e.rXU(h.V),e.rXU(n.hG),e.rXU(m.Ix),e.rXU(C.a))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-cadbomba"]],decls:19,vars:3,consts:[[3,"translucent"],["slot","start"],["position","stacked"],["type","number","inputmode","numeric","placeholder","Digite o c\xf3digo da bomba",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Digite os bicos",3,"ngModelChange","ngModel"],["expand","block",3,"click"],["expand","block","color","secondary",3,"click"]],template:function(o,i){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Cadastro de Bombas"),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-item")(8,"ion-label",2),e.EFF(9,"C\xf3digo da Bomba"),e.k0s(),e.j41(10,"ion-input",3),e.mxI("ngModelChange",function(a){return e.DH7(i.newBomba.idbomba,a)||(i.newBomba.idbomba=a),a}),e.k0s()(),e.j41(11,"ion-item")(12,"ion-label",2),e.EFF(13,"Bicos (separados por v\xedrgula)"),e.k0s(),e.j41(14,"ion-input",4),e.mxI("ngModelChange",function(a){return e.DH7(i.newBomba.idbicos,a)||(i.newBomba.idbicos=a),a}),e.k0s()(),e.j41(15,"ion-button",5),e.bIt("click",function(){return i.saveBomba()}),e.EFF(16,"Gravar"),e.k0s(),e.j41(17,"ion-button",6),e.bIt("click",function(){return i.voltarPagina()}),e.EFF(18,"Cancelar"),e.k0s()()),2&o&&(e.Y8G("translucent",!0),e.R7$(10),e.R50("ngModel",i.newBomba.idbomba),e.R7$(4),e.R50("ngModel",i.newBomba.idbicos))},dependencies:[g.BC,g.vS,n.Jm,n.QW,n.W9,n.eU,n.$w,n.uz,n.he,n.MC,n.BC,n.ai,n.su,n.Gw]}),d})()}];let y=(()=>{var t;class d{}return(t=d).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[m.iI.forChild(w),m.iI]}),d})(),S=(()=>{var t;class d{}return(t=d).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[p.MD,g.YN,n.bv,y]}),d})()}}]);
//# sourceMappingURL=5447.16030948073d9e60.js.map