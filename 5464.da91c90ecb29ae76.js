"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5464],{5464:(F,h,m)=>{m.r(h),m.d(h,{CadcombustivelPageModule:()=>P});var f=m(316),C=m(496),r=m(957),g=m(1379),v=m(9204),w=m(6443),e=m(7404),M=m(7125),E=m(4979),S=m(3857),A=m(4747),D=m(9581);function I(l,d){if(1&l&&(e.j41(0,"ion-select-option",17),e.EFF(1),e.k0s()),2&l){const c=d.$implicit;e.Y8G("value",c),e.R7$(),e.JRh(c)}}const y=[{path:"",component:(()=>{var l;class d{constructor(o,t,s,i,n,u,a,b){this.combustivelService=o,this.route=t,this.combustivelDataService=s,this.alertController=i,this.router=n,this.bombaService=u,this.utilService=a,this.produtoService=b,this.newCombustivel={id:null,nome:"",idbicos:"",idbombas:"",preco:0,tipoproduto:"",status:!0,ehcombustivel:!0,ncm:"",anp:"",codigobarras:""},this.tiposproduto=["ETANOL","ETANOL_ADITIVADO","GASOLINA","GASOLINA_ADITIVADA","DIESEL","DIESEL_S500_ADITIVADO","DIESEL_ADITIVADO","DIESEL_S10_ADITIVADO","GASOLINA_PODIUM","GASOLINA_PREMIUM","GNV","ARLA32","QUEROSENE","GASOLINA_TROCA_OLEO","PONTUACAO","OUTRO"]}ngOnInit(){this.loadCombustivel()}loadCombustivel(){const o=this.combustivelDataService.getCombustivel();o&&(this.newCombustivel=o)}saveCombustivel(){var o=this;return(0,v.A)(function*(){if(!(o.newCombustivel.nome&&o.newCombustivel.idbicos&&o.newCombustivel.idbombas&&o.newCombustivel.preco&&o.newCombustivel.tipoproduto))return void(yield o.utilService.showAlert("Erro","Todos os campos s\xe3o obrigat\xf3rios."));if(o.newCombustivel.idbicos=o.newCombustivel.idbicos.replace(/(^,)|(,$)/g,""),o.newCombustivel.idbombas=o.newCombustivel.idbombas.replace(/(^,)|(,$)/g,""),!/^(\d+)(,\d+)*$/.test(o.newCombustivel.idbicos))return void(yield o.utilService.showAlert("Erro","O campo Bicos deve conter apenas n\xfameros e v\xedrgulas."));if(!/^(\d+)(,\d+)*$/.test(o.newCombustivel.idbombas))return void(yield o.utilService.showAlert("Erro","O campo Bombas deve conter apenas n\xfameros e v\xedrgulas."));if(!/^\d+([.,]\d{1,2})?$/.test(o.newCombustivel.preco.toString()))return void(yield o.utilService.showAlert("Erro","O campo Pre\xe7o deve conter apenas n\xfameros e ponto, com no m\xe1ximo 2 casas decimais."));const n=o.combustivelDataService.getCombustivel();if(null!=(null==n?void 0:n.id)&&(null==n?void 0:n.id)!=o.newCombustivel.id)return void(yield o.utilService.showAlert("Erro","N\xe3o \xe9 permitido atualizar o c\xf3digo do combust\xedvel."));const u=yield o.combustivelService.getCombustivelById(o.newCombustivel.id);if(u&&(null==n?void 0:n.id)>0)return void(yield o.utilService.showAlert("Erro",`O combust\xedvel ${u.id} j\xe1 foi cadastrado.`));if(!(yield o.validaSeBombasEBicosExistem()))return;const a=yield o.bicoJaExisteNoCombustivel();if(o.combustiveisDiferentes=!1,null!=a&&(o.combustiveisDiferentes=a.id!=o.newCombustivel.id),a&&o.combustiveisDiferentes){const p=yield o.retornaBicoDuplicado(a);return void(yield o.utilService.showAlert("Erro",`O bico ${p} j\xe1 est\xe1 cadastrado no combust\xedvel: ${a.id} - ${a.nome}.`))}a&&(console.log(`Combust\xedvel deletado: ${a.id}`),o.combustivelService.deleteCombustivel(a.id));let b="";if(0!=o.newCombustivel.id&&null==u){const p=yield o.combustivelService.addCombustivel(o.newCombustivel.id,o.newCombustivel.nome,o.newCombustivel.idbicos,o.newCombustivel.idbombas,o.newCombustivel.preco,o.newCombustivel.tipoproduto,o.newCombustivel.status,o.newCombustivel.ehcombustivel,o.newCombustivel.ncm,o.newCombustivel.anp,o.newCombustivel.codigobarras);o.newCombustivel.id=p,b=`Combust\xedvel ${p} - ${o.newCombustivel.nome} adicionado com sucesso!`}else yield o.combustivelService.updateCombustivel(o.newCombustivel.id,o.newCombustivel.nome,o.newCombustivel.idbicos,o.newCombustivel.idbombas,o.newCombustivel.preco,o.newCombustivel.tipoproduto,o.newCombustivel.status,o.newCombustivel.ehcombustivel,o.newCombustivel.ncm,o.newCombustivel.anp,o.newCombustivel.codigobarras),b=`Combust\xedvel ${o.newCombustivel.id} - ${o.newCombustivel.nome} atualizado com sucesso!`;yield o.sincronizarCombustivel(),yield(yield o.alertController.create({header:"Sucesso",message:b,buttons:[{text:"OK",handler:()=>{o.router.navigate(["/combustivel"])}}]})).present()})()}retornaBicoDuplicado(o){var t=this;return(0,v.A)(function*(){const s=t.newCombustivel.idbicos.split(",").map(n=>n.trim()),i=o.idbicos.split(",").map(n=>n.trim());for(const n of s)if(i.includes(n))return n;return""})()}bicoJaExisteNoCombustivel(){var o=this;return(0,v.A)(function*(){const t=o.newCombustivel.idbicos.split(",").map(i=>i.trim()),s=yield o.combustivelService.getAllCombustiveis();for(const i of s){const n=i.idbicos.split(",").map(u=>u.trim());for(const u of t)if(n.includes(u)&&o.newCombustivel.id!=i.id)return i}return null})()}voltarPagina(){this.router.navigate(["/combustivel"])}validaSeBombasEBicosExistem(){var o=this;return(0,v.A)(function*(){const t=yield o.bombaService.getAllBombas(),s=o.newCombustivel.idbombas.split(",").map(Number),i=o.newCombustivel.idbicos.split(",").map(Number);for(const u of s){let a=!1;for(const b of t)if(Number(b.idbomba)===u){a=!0;break}if(!a)return yield o.utilService.showAlert("Erro de Valida\xe7\xe3o",`A bomba ${u} n\xe3o existe.`),!1}const n=[];t.forEach(u=>{u.idbicos.split(",").map(Number).forEach(a=>{n.includes(a)||n.push(a)})});for(const u of i)if(!n.includes(u))return yield o.utilService.showAlert("Erro de Valida\xe7\xe3o",`O bico ${u} n\xe3o est\xe1 vinculado a nenhuma bomba.`),!1;return!0})()}retornaStatusString(o){return(0,v.A)(function*(){return o?"ATIVO":"INATIVO"})()}sincronizarCombustivel(){var o=this;return(0,v.A)(function*(){const t=yield o.retornaStatusString(o.newCombustivel.status),s={codigoProduto:o.newCombustivel.id.toString(),Descricao:o.newCombustivel.nome,tipoProduto:o.newCombustivel.tipoproduto,status:t,preco:o.utilService.verificarEConverterPreco(o.newCombustivel.preco),ehCombustivel:o.newCombustivel.ehcombustivel,ncm:o.newCombustivel.ncm.toString(),anp:o.newCombustivel.anp.toString(),codigoBarras:o.newCombustivel.codigobarras.toString()};try{const i=yield o.produtoService.sincronizarProdutoSingle(s);return console.log(`${JSON.stringify(s)}`),console.log(`TraceID: ${i.trace_Id}`),console.log(`statusCode: ${i.statusCode}`),!!(i.statusCode=200)||(yield o.utilService.showAlert("Erro",`N\xe3o foi poss\xedvel sincronizar o combust\xedvel: ${i.errmsg}`),!1)}catch(i){console.error("Erro ao sincronizar combust\xedvel:",i);let n="Erro desconhecido";return i instanceof w.yz&&(i.error&&"object"==typeof i.error&&"errmsg"in i.error?n=i.error.errmsg:i.message&&(n=i.message)),yield o.utilService.showAlert("Erro",`N\xe3o foi poss\xedvel sincronizar o combust\xedvel: ${n}`),!1}})()}}return(l=d).\u0275fac=function(o){return new(o||l)(e.rXU(M.j),e.rXU(g.nX),e.rXU(E.j),e.rXU(r.hG),e.rXU(g.Ix),e.rXU(S.J),e.rXU(A.a),e.rXU(D.N))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-cadcombustivel"]],decls:51,vars:12,consts:[[3,"translucent"],["slot","start"],["position","stacked"],["type","number","inputmode","numeric","placeholder","Digite o c\xf3digo do combust\xedvel",3,"ngModelChange","ngModel"],["placeholder","Digite o nome",3,"ngModelChange","ngModel"],["lines","full"],["required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","inputmode","decimal","placeholder","Digite o pre\xe7o",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Digite as bombas",3,"ngModelChange","ngModel"],["type","text","inputmode","decimal","placeholder","Digite os bicos",3,"ngModelChange","ngModel"],["type","number","inputmode","numeric","placeholder","Digite o NCM",3,"ngModelChange","ngModel"],["type","number","inputmode","numeric","placeholder","Digite o ANP",3,"ngModelChange","ngModel"],["type","number","inputmode","numeric","placeholder","Digite o C\xf3digo de Barras",3,"ngModelChange","ngModel"],["labelPlacement","end","justify","start",3,"ngModelChange","ngModel"],["expand","block",3,"click"],["expand","block","color","secondary",3,"click"],[3,"value"]],template:function(o,t){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Cadastro de Combust\xedvel"),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-item")(8,"ion-label",2),e.EFF(9,"C\xf3digo"),e.k0s(),e.j41(10,"ion-input",3),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.id,i)||(t.newCombustivel.id=i),i}),e.k0s()(),e.j41(11,"ion-item")(12,"ion-label",2),e.EFF(13,"Nome"),e.k0s(),e.j41(14,"ion-input",4),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.nome,i)||(t.newCombustivel.nome=i),i}),e.k0s()(),e.j41(15,"ion-item",5)(16,"ion-label",2),e.EFF(17,"Tipo de produto"),e.k0s(),e.j41(18,"ion-select",6),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.tipoproduto,i)||(t.newCombustivel.tipoproduto=i),i}),e.DNE(19,I,2,2,"ion-select-option",7),e.k0s()(),e.j41(20,"ion-item")(21,"ion-label",2),e.EFF(22,"Pre\xe7o"),e.k0s(),e.j41(23,"ion-input",8),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.preco,i)||(t.newCombustivel.preco=i),i}),e.k0s()(),e.j41(24,"ion-item")(25,"ion-label",2),e.EFF(26,"Bombas (separadas por v\xedrgula)"),e.k0s(),e.j41(27,"ion-input",9),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.idbombas,i)||(t.newCombustivel.idbombas=i),i}),e.k0s()(),e.j41(28,"ion-item")(29,"ion-label",2),e.EFF(30,"Bicos (separados por v\xedrgula)"),e.k0s(),e.j41(31,"ion-input",10),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.idbicos,i)||(t.newCombustivel.idbicos=i),i}),e.k0s()(),e.j41(32,"ion-item")(33,"ion-label",2),e.EFF(34,"NCM"),e.k0s(),e.j41(35,"ion-input",11),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.ncm,i)||(t.newCombustivel.ncm=i),i}),e.k0s()(),e.j41(36,"ion-item")(37,"ion-label",2),e.EFF(38,"ANP"),e.k0s(),e.j41(39,"ion-input",12),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.anp,i)||(t.newCombustivel.anp=i),i}),e.k0s()(),e.j41(40,"ion-item")(41,"ion-label",2),e.EFF(42,"C\xf3digo de Barras"),e.k0s(),e.j41(43,"ion-input",13),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.codigobarras,i)||(t.newCombustivel.codigobarras=i),i}),e.k0s()(),e.j41(44,"ion-item")(45,"ion-checkbox",14),e.mxI("ngModelChange",function(i){return e.DH7(t.newCombustivel.status,i)||(t.newCombustivel.status=i),i}),e.EFF(46,"Status (Ativo ou Inativo) "),e.k0s()(),e.j41(47,"ion-button",15),e.bIt("click",function(){return t.saveCombustivel()}),e.EFF(48,"Gravar"),e.k0s(),e.j41(49,"ion-button",16),e.bIt("click",function(){return t.voltarPagina()}),e.EFF(50,"Cancelar"),e.k0s()()),2&o&&(e.Y8G("translucent",!0),e.R7$(10),e.R50("ngModel",t.newCombustivel.id),e.R7$(4),e.R50("ngModel",t.newCombustivel.nome),e.R7$(4),e.R50("ngModel",t.newCombustivel.tipoproduto),e.R7$(),e.Y8G("ngForOf",t.tiposproduto),e.R7$(4),e.R50("ngModel",t.newCombustivel.preco),e.R7$(4),e.R50("ngModel",t.newCombustivel.idbombas),e.R7$(4),e.R50("ngModel",t.newCombustivel.idbicos),e.R7$(4),e.R50("ngModel",t.newCombustivel.ncm),e.R7$(4),e.R50("ngModel",t.newCombustivel.anp),e.R7$(4),e.R50("ngModel",t.newCombustivel.codigobarras),e.R7$(2),e.R50("ngModel",t.newCombustivel.status))},dependencies:[f.Sq,C.BC,C.YS,C.vS,r.Jm,r.QW,r.eY,r.W9,r.eU,r.$w,r.uz,r.he,r.MC,r.Nm,r.Ip,r.BC,r.ai,r.hB,r.su,r.Je,r.Gw]}),d})()}];let _=(()=>{var l;class d{}return(l=d).\u0275fac=function(o){return new(o||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[g.iI.forChild(y),g.iI]}),d})(),P=(()=>{var l;class d{}return(l=d).\u0275fac=function(o){return new(o||l)},l.\u0275mod=e.$C({type:l}),l.\u0275inj=e.G2t({imports:[f.MD,C.YN,r.bv,_]}),d})()}}]);
//# sourceMappingURL=5464.da91c90ecb29ae76.js.map